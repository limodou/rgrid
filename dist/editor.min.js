function _simple_select2(e,t){var o=$(e),i=o.attr("data-url")||o.attr("url"),l=o.attr("placeholder")||"请选择";t=t||{},"string"==typeof t&&(i=t,t={});var r,n,a=t.limit||10;r=i?{minimumInputLength:2,width:"100%",placeholder:{id:"",placeholder:l},allowClear:!0,language:"zh-CN",ajax:{url:i,data:function(e){return{term:e.term,label:"text",page:e.page,limit:a}},dataType:"json",processResults:function(e,t){return t.page=t.page||1,Array.isArray(e)?(n=e,total=0):(n=e.rows,total=e.total),{results:n,pagination:{more:t.page*a<total}}}}}:{width:"100%",allowClear:!0,placeholder:{id:"",placeholder:l},language:"zh-CN"},o.select2($.extend(!0,{},r,t))}var string_editor=function(e,t,o){var i=this,l=$(e),r=l.width(),n=l.height(),a=$(riot.util.tmpl('<input type="text" name={name} value="{value}" placeholder="{placeholder}" class="inline-editor"></input>',o));return a.css({position:"absolute",left:l.css("paddingLeft"),top:0,width:r,height:n,margin:0,padding:0,border:"none",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"#ffefd5"}),l.append(a),a.focus().select(),a.on("keyup",function(e){if(13==e.keyCode){var l=a.val();t[o.name]=l,$.when(i.onEdited(t,o,l)).then(function(e){e&&(i.root.update(t),a.destroy())})}else 27==e.keyCode&&a.destroy()}),a.on("blur",function(e){a.destroy()}),a.destroy=function(){a.remove(),i.editor=null},a},select_editor=function(e,t,o){var i,l=this,r=$(e),n=r.width(),a=r.height(),d=['<select name="'+o.name+'" class="inline-editor" '+(o.editor.multiple?'multiple="multiple"':"")+">"],u=o.editor.choices;o.editor.placeholder&&d.push('<option value="">'+o.editor.placeholder+"</option>");for(var s=0,p=u.length;s<p;s++)i={value:o.value,option_value:u[s][0],option_text:u[s][1]},d.push(riot.util.tmpl('<option {value==option_value?"selected":""} value={option_value}>{option_text}</option>',i));d.push("</select>");var c=$(d.join(""));return c.css({position:"absolute",left:0,top:0,width:n,height:a,margin:0,padding:0,border:"none",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"#ffefd5"}),r.append(c),c.focus(),c.on("change",function(e){var i=c.val();t[o.name]=i,$.when(l.onEdited(t,o,i)).then(function(e){e&&(l.root.update(t),c.destroy())})}),c.destroy=function(){c.remove(),l.editor=null},c},date_editor=function(e,t,o){var i=this,l=$(e),r=l.width(),n=l.height(),a=$(riot.util.tmpl('<input type="text" name={name} value="{value}" placeholder="{placeholder}" class="inline-editor"></input>',o));return a.css({position:"absolute",left:0,top:0,width:r,height:n,margin:0,padding:0,border:"none",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"#ffefd5"}),l.append(a),a.focus().select().pikaday({format:"YYYY-MM-DD",showTime:!1,onClose:function(){var e=a.val();t[o.name]=e,$.when(i.onEdited(t,o,e)).then(function(e){e&&(i.root.update(t),a.destroy())})}}),a.pikaday("show"),a.destroy=function(){a.remove(),i.editor=null},a},select2_editor=function(e,t,o){var i,l,r=this,n=$(e),a=n.width(),d=n.height(),u=['<select name="'+o.name+'" class="inline-editor" '+(o.editor.multiple?'multiple="multiple"':"")+">"],s=[],p=[],c=o.editor.value_from;if(o.editor.multiple)if(c)if(l=o.row[c].value,Array.isArray(l))for(var h=0,f=l.length;h<f;h++)p.push([o.row[c].value[h],o.row[c].text[h]]);else p=[[o.row[c].value,o.row[c].text]];else l=o.value,p=[[l,l]];else c?o.row[c]instanceof Object?(l=o.row[c].value,p=[[o.row[c].value,o.row[c].text]]):(l=o.row[c].value,p=[[l,o.value]]):(l=[o.value],p=[[o.value,o.value]]);var p=o.editor.choices?o.editor.choices:p;o.editor.placeholder&&u.push('<option value="">'+o.editor.placeholder+"</option>");for(var v=0,m=p.length;v<m;v++)i={value:l,option_value:p[v][0],option_text:p[v][1]},Array.isArray(l)?i.selected=l.indexOf(i.option_value)>-1:i.selected=l==i.option_value,u.push(riot.util.tmpl('<option {selected?"selected":""} value={option_value}>{option_text}</option>',i));u.push("</select>");var g=$(u.join(""));return g.css({position:"absolute",left:0,top:0,width:a,height:d,margin:0,padding:0,border:"none",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"#ffefd5"}),n.append(g),g.focus(),o.editor.url&&g.attr("url",o.editor.url),o.editor["data-url"]&&g.attr("url",o.editor["data-url"]),o.editor.placeholder&&g.attr("placeholder",o.editor.placeholder),_simple_select2(g),n.find(".select2-container").css({zIndex:2e3,position:"absolute",left:0,top:0}),n.css({overflow:"visible",position:"relative"}),g.on("select2:close",function(e){g.destroy()}),g.on("change",function(e){var i=g.val();if(t[o.name]=i,o.editor.value_from)if(o.editor.multiple){for(var l=0,n=g.select2("data").length;l<n;l++)s.push(g.select2("data")[l].text);t[o.editor.value_from]={value:i,text:s}}else s=g.select2("data")[0].text,t[o.editor.value_from]={value:i,text:s};else t[o.name]=i;$.when(r.onEdited(t,o,i)).then(function(e){e&&(r.root.update(t),g.destroy())})}),g.destroy=function(){g.data("select2")&&g.select2("destroy"),g.remove(),r.editor=null},g};