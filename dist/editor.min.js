function _simple_select2(e,t){var o=$(e),i=o.attr("data-url")||o.attr("url"),r=o.attr("placeholder")||"请选择";t=t||{},"string"==typeof t&&(i=t,t={});var l,a,n=t.limit||10;l=i?{minimumInputLength:2,width:"100%",placeholder:{id:"",placeholder:r},allowClear:!0,language:"zh-CN",ajax:{url:i,data:function(e){return{term:e.term,label:"text",page:e.page,limit:n}},dataType:"json",processResults:function(e,t){return t.page=t.page||1,Array.isArray(e)?(a=e,total=0):(a=e.rows,total=e.total),{results:a,pagination:{more:t.page*n<total}}}}}:{width:"100%",allowClear:!0,placeholder:{id:"",placeholder:r},language:"zh-CN"},o.select2($.extend(!0,{},l,t))}var string_editor=function(e,t,o){var i=this,r=$(e),l=r.width(),a=r.height(),n=$(riot.util.tmpl('<input type="text" name={name} value="{value}" placeholder="{placeholder}" class="inline-editor"></input>',o));return n.css({position:"absolute",left:r.css("paddingLeft"),top:0,width:l,height:a,margin:0,padding:0,border:"1 solid gray",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"white"}),r.append(n),n.focus().select(),n.on("keyup",function(e){if(13==e.keyCode){var r=n.val();t[o.name]=r,$.when(i.onEdited(t,o,r)).then(function(e){e&&(i.root.update(t),n.destroy())})}else 27==e.keyCode&&n.destroy()}),n.on("blur",function(e){n.destroy()}),n.destroy=function(){n.remove(),i.editor=null},n},select_editor=function(e,t,o){var i,r=this,l=$(e),a=l.width(),n=l.height(),d=['<select name="'+o.name+'" class="inline-editor" '+(o.editor.multiple?'multiple="multiple"':"")+">"],s=o.editor.choices;o.editor.placeholder&&d.push('<option value="">'+o.editor.placeholder+"</option>");for(var u=0,p=s.length;u<p;u++)i={value:o.value,option_value:s[u][0],option_text:s[u][1]},d.push(riot.util.tmpl('<option {value==option_value?"selected":""} value={option_value}>{option_text}</option>',i));d.push("</select>");var c=$(d.join(""));return c.css({position:"absolute",left:0,top:0,width:a,height:n,margin:0,padding:0,border:"1 solid gray",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"white"}),l.append(c),c.focus(),c.on("change",function(e){var i=c.val();t[o.name]=i,$.when(r.onEdited(t,o,i)).then(function(e){e&&(r.root.update(t),c.destroy())})}),c.destroy=function(){c.remove(),r.editor=null},c},date_editor=function(e,t,o){var i=this,r=$(e),l=r.width(),a=r.height(),n=$(riot.util.tmpl('<input type="text" name={name} value="{value}" placeholder="{placeholder}" class="inline-editor"></input>',o));return n.css({position:"absolute",left:0,top:0,width:l,height:a,margin:0,padding:0,border:"1 solid gray",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"white"}),r.append(n),n.focus().select().pikaday({format:"YYYY-MM-DD",showTime:!1,onClose:function(){var e=n.val();t[o.name]=e,$.when(i.onEdited(t,o,e)).then(function(e){e&&(i.root.update(t),n.destroy())})}}),n.pikaday("show"),n.destroy=function(){n.remove(),i.editor=null},n},select2_editor=function(e,t,o){var i,r,l=this,a=$(e),n=a.width(),d=a.height(),s=['<select name="'+o.name+'" class="inline-editor" '+(o.editor.multiple?'multiple="multiple"':"")+">"],u=[],p=[],c=o.editor.value_from;if(r=c?o.row[c].value:o.value)if(c)if(Array.isArray(r))for(var h=0,v=r.length;h<v;h++)p.push([o.row[c].value[h],o.row[c].text[h]]);else p=[[o.row[c].value,o.row[c].text]];else if(Array.isArray(r))for(var h=0,v=r.length;h<v;h++)p.push([r[h],r[h]]);else p=[[r,r]];var p=o.editor.choices?o.editor.choices:p;o.editor.placeholder&&s.push('<option value="">'+o.editor.placeholder+"</option>");for(var f=0,g=p.length;f<g;f++)i={value:r,option_value:p[f][0],option_text:p[f][1]},Array.isArray(r)?i.selected=r.indexOf(i.option_value)>-1:i.selected=r==i.option_value,s.push(riot.util.tmpl('<option {selected?"selected":""} value={option_value}>{option_text}</option>',i));s.push("</select>");var m=$(s.join(""));return m.css({position:"absolute",left:0,top:0,width:n,height:d,margin:0,padding:0,border:"1 solid gray",boxSizing:"border-box",zIndex:1e3,fontSize:14,backgroundColor:"white"}),a.append(m),m.focus(),o.editor.url&&m.attr("url",o.editor.url),o.editor["data-url"]&&m.attr("url",o.editor["data-url"]),o.editor.placeholder&&m.attr("placeholder",o.editor.placeholder),_simple_select2(m),a.find(".select2-container").css({zIndex:2e3,position:"absolute",left:0,top:0}),a.css({overflow:"visible",position:"relative"}),m.on("select2:close",function(e){m.destroy()}),m.on("change",function(e){var i=m.val();if(t[o.name]=i,o.editor.value_from)if(o.editor.multiple){for(var r=0,a=m.select2("data").length;r<a;r++)u.push(m.select2("data")[r].text);t[o.editor.value_from]={value:i,text:u}}else u=m.select2("data")[0].text,t[o.editor.value_from]={value:i,text:u};else t[o.name]=i;$.when(l.onEdited(t,o,i)).then(function(e){e&&(l.root.update(t),m.destroy())})}),m.destroy=function(){m.data("select2")&&m.select2("destroy"),m.remove(),l.editor=null},m};