riot.tag2("rtable",'<yield></yield> <div class="rtable-root {theme}" riot-style="width:{width-1}px;height:{height-1+xscroll_fix}px"> <div class="rtable-header rtable-fixed" riot-style="width:{fix_width}px;height:{header_height}px"> <div each="{fix_columns}" no-reorder class="{rtable-cell:true}" riot-style="width:{width}px;height:{height}px;left:{left}px;top:{top}px;line-height:{height}px;"> <div if="{type!=\'check\'}" data-is="rtable-raw" class="rtable-cell-text" value="{title}" riot-style="{sort?\'padding-right:22px\':\'\'}" title="{tooltip}"></div> <i if="{type==\'check\' && parent.multiSelect}" onclick="{checkall}" class="fa {parent.selected_rows.length>0 ? \'fa-check-square-o\' : \'fa-square-o\'}" riot-style="cursor:pointer;height:{headerRowHeight}px;line-height:{headerRowHeight}px"></i> <div if="{!fixed && leaf}" class="rtable-resizer" onmousedown="{colresize}"></div> <i if="{sort}" class="rtable-sort fa {get_sorted(name)}" title="{sort}" onclick="{sort_handler}" riot-style="height:{rowHeight}px;line-height:{rowHeight}px;right:4px;"> </i> </div> </div> <div class="rtable-header rtable-main" riot-style="width:{width-fix_width-yscroll_fix}px;right:0px;height:{header_height}px;left:{fix_width}px;"> <div each="{main_columns}" no-reorder class="{rtable-cell:true}" riot-style="width:{width}px;height:{height}px;left:{left}px;top:{top}px;line-height:{height}px;"> <div if="{type!=\'check\'}" data-is="rtable-raw" class="rtable-cell-text" value="{title}" riot-style="{sort?\'padding-right:22px\':\'\'}" title="{tooltip}"></div> <i if="{type==\'check\' && parent.multiSelect}" onclick="{checkall}" class="fa {parent.selected_rows.length>0 ? \'fa-check-square-o\' : \'fa-square-o\'}" riot-style="cursor:pointer;height:{headerRowHeight}px;line-height:{headerRowHeight}px"></i> <div if="{!fixed && leaf}" class="rtable-resizer" onmousedown="{colresize}"></div> <i if="{sort}" class="rtable-sort fa {get_sorted(name)}" title="{sort}" onclick="{sort_handler}" riot-style="height:{rowHeight}px;line-height:{rowHeight}px;right:4px;"> </i> </div> </div> <div class="rtable-body rtable-fixed" riot-style="width:{fix_width}px;bottom:0;padding-bottom:{xscroll_fix}px;top:{header_height}px;height:{height-header_height}px;"> <div class="rtable-content" riot-style="width:{fix_width}px;height:{rows.length*rowHeight}px;"> <div each="{row in visCells.fixed}" no-reorder class="{get_row_class(row.row, row.line)}"> <div if="{col.height!=0 && col.width!=0}" each="{col in row.cols}" no-reorder class="{get_cell_class(col)}" riot-style="width:{col.width}px;height:{col.height}px;left:{col.left}px;top:{col.top}px;line-height:{col.height}px;text-align:{col.align};"> <div data-is="rtable-cell" if="{col.type!=\'check\' && !col.buttons}" tag="{col.tag}" value="{col.__value__}" row="{col.row}" col="{col}" riot-style="{col.indentWidth}" title="{col.tooltip}"></div> <span if="{col.expander}" data-is="rtable-raw" content="{col.expander}" class="rtable-expander" riot-style="left:{col.indent-12}px;" onclick="{toggle_expand}"></span> <i if="{col.type==\'check\' && onCheckable(col.row)}" onclick="{checkcol}" class="fa {is_selected(col.row)?\'fa-check-square-o\':\'fa-square-o\'}" riot-style="cursor:pointer;height:{rowHeight}px;line-height:{rowHeight}px"></i> <span if="{col.notation}" class="rtable-notation {col.notation.type}" title="{col.notation.title}"></span> </div> </div> </div> </div> <div class="rtable-body rtable-main" riot-style="left:{fix_width}px;top:{header_height}px;bottom:0px;right:0px;width:{width-fix_width+(browser.ie?yscroll_fix:0)}px;height:{height-header_height+(browser.ie?2*xscroll_fix:xscroll_fix)}px;"> <div class="rtable-content" riot-style="width:{main_width}px;height:{rows.length*rowHeight}px;"> <div each="{row in visCells.main}" no-reorder class="{get_row_class(row.row, row.line)}"> <div if="{col.height!=0 && col.width!=0}" each="{col in row.cols}" no-reorder class="{get_cell_class(col)}" riot-style="width:{col.width}px;height:{col.height}px;left:{col.left}px;top:{col.top}px;line-height:{col.height}px;text-align:{col.align};"> <div data-is="rtable-cell" if="{col.type!=\'check\' && !col.buttons}" tag="{col.tag}" value="{col.__value__}" row="{col.row}" col="{col}" riot-style="{col.indentWidth}" title="{col.tooltip}"></div> <span if="{col.expander}" data-is="rtable-raw" value="{col.expander}" class="rtable-expander" riot-style="left:{col.indent-12}px;" onclick="{toggle_expand}"></span> <i if="{col.type==\'check\' && onCheckable(col.row)}" onclick="{checkcol}" class="fa {is_selected(col.row)?\'fa-check-square-o\':\'fa-square-o\'}" riot-style="cursor:pointer;height:{rowHeight}px;line-height:{rowHeight}px"></i> <virtual if="{col.buttons}" no-reorder each="{btn in col.buttons}"> <i if="{btn.icon}" class="fa fa-{btn.icon} action" title="{btn.title}" onclick="{parent.parent.action_click(parent.col, btn)}"></i> <a if="{btn.label}" class="action" title="{btn.title}" href="{btn.href || \'#\'}" onclick="{parent.parent.action_click(parent.col, btn)}">{btn.label}</a> </virtual> <span if="{col.notation}" class="rtable-notation {col.notation.type}" title="{col.notation.title}"></span> </div> </div> </div> </div> <div if="{rows.length==0 && noData}" data-is="rtable-raw" value="{noData}" class="rtable-nodata" riot-style="top:{height/2-header_height/2+rowHeight/2}px;"></div> <div riot-style="display:none;top:{height/2-header_height/2+rowHeight/2}px" class="rtable-loading"></div> </div> </div>','rtable .action,[riot-tag="rtable"] .action,[data-is="rtable"] .action{cursor:pointer;} rtable .rtable-root,[riot-tag="rtable"] .rtable-root,[data-is="rtable"] .rtable-root{ position:relative; border: 1px solid gray; overflow:hidden; } rtable .rtable-header,[riot-tag="rtable"] .rtable-header,[data-is="rtable"] .rtable-header{ position:absolute; box-sizing: border-box; } rtable .rtable-header.rtable-fixed,[riot-tag="rtable"] .rtable-header.rtable-fixed,[data-is="rtable"] .rtable-header.rtable-fixed{ left:0; top:0; } rtable .rtable-header.rtable-main,[riot-tag="rtable"] .rtable-header.rtable-main,[data-is="rtable"] .rtable-header.rtable-main{ top:0; overflow:hidden; } rtable .rtable-content,[riot-tag="rtable"] .rtable-content,[data-is="rtable"] .rtable-content{ overflow: hidden; } rtable .rtable-cell,[riot-tag="rtable"] .rtable-cell,[data-is="rtable"] .rtable-cell{ position:absolute; box-sizing: border-box; border-right:1px solid gray; border-bottom:1px solid gray; background-color: white; white-space: nowrap; text-overflow: ellipsis; } rtable .rtable-cell-text-wrapper,[riot-tag="rtable"] .rtable-cell-text-wrapper,[data-is="rtable"] .rtable-cell-text-wrapper{ height: 100%; } rtable .rtable-cell-text,[riot-tag="rtable"] .rtable-cell-text,[data-is="rtable"] .rtable-cell-text{ position:relative; padding-left:4px; padding-right:4px; height: 100%; } rtable .rtable-cell-text,[riot-tag="rtable"] .rtable-cell-text,[data-is="rtable"] .rtable-cell-text,rtable .rtable-cell-text>*,[riot-tag="rtable"] .rtable-cell-text>*,[data-is="rtable"] .rtable-cell-text>*{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } rtable .rtable-cell > .rtable-resizer,[riot-tag="rtable"] .rtable-cell > .rtable-resizer,[data-is="rtable"] .rtable-cell > .rtable-resizer{ width:4px; position:absolute; height:100%; cursor: col-resize; top:0px; right:0px; } rtable .rtable-cell .rtable-sort,[riot-tag="rtable"] .rtable-cell .rtable-sort,[data-is="rtable"] .rtable-cell .rtable-sort{ position: absolute; right: 2px; top:0px; z-index: 102; cursor: pointer; opacity: 0.3; } rtable .rtable-cell .rtable-sort.fa-sort-desc,[riot-tag="rtable"] .rtable-cell .rtable-sort.fa-sort-desc,[data-is="rtable"] .rtable-cell .rtable-sort.fa-sort-desc,rtable .rtable-cell .rtable-sort.fa-sort-asc,[riot-tag="rtable"] .rtable-cell .rtable-sort.fa-sort-asc,[data-is="rtable"] .rtable-cell .rtable-sort.fa-sort-asc{ opacity: 1; } rtable .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-header .rtable-cell,[data-is="rtable"] .rtable-header .rtable-cell{ text-align:center; vertical-align: middle; } rtable .rtable-body,[riot-tag="rtable"] .rtable-body,[data-is="rtable"] .rtable-body{ position:absolute; box-sizing: border-box; } rtable .rtable-body.rtable-fixed,[riot-tag="rtable"] .rtable-body.rtable-fixed,[data-is="rtable"] .rtable-body.rtable-fixed{ left:0; overflow: hidden; } rtable .rtable-body.rtable-main,[riot-tag="rtable"] .rtable-body.rtable-main,[data-is="rtable"] .rtable-body.rtable-main{ overflow: auto; } rtable .rtable-nodata,[riot-tag="rtable"] .rtable-nodata,[data-is="rtable"] .rtable-nodata{ position:relative; margin: auto; height: 34px; text-align: center; color: #ccc; line-height: 34px; } rtable .rtable-loading,[riot-tag="rtable"] .rtable-loading,[data-is="rtable"] .rtable-loading{ position:relative;; margin: auto; height: 34px; text-align: center; color: black; line-height: 34px; border: 1px solid gray; width: 100px; background-color: antiquewhite; z-index: 9999; } rtable .rtable-expander,[riot-tag="rtable"] .rtable-expander,[data-is="rtable"] .rtable-expander{ position:absolute; top:0px; cursor:pointer; font-size:14px; } rtable .rtable-row.hover .rtable-cell,[riot-tag="rtable"] .rtable-row.hover .rtable-cell,[data-is="rtable"] .rtable-row.hover .rtable-cell{ background-color: #e1eff8; } rtable .rtable-row.selected.hover .rtable-cell,[riot-tag="rtable"] .rtable-row.selected.hover .rtable-cell,[data-is="rtable"] .rtable-row.selected.hover .rtable-cell{ background-color: #ffefd5; } rtable .rtable-row.selected .rtable-cell,[riot-tag="rtable"] .rtable-row.selected .rtable-cell,[data-is="rtable"] .rtable-row.selected .rtable-cell{ background-color:#ffefd5; } rtable .rtable-root.zebra .rtable-row.even .rtable-cell,[riot-tag="rtable"] .rtable-root.zebra .rtable-row.even .rtable-cell,[data-is="rtable"] .rtable-root.zebra .rtable-row.even .rtable-cell{ background-color: #f9f9f9; border-bottom:none; border-right:1px solid #ddd; } rtable .rtable-root.zebra .rtable-row.even.hover .rtable-cell,[riot-tag="rtable"] .rtable-root.zebra .rtable-row.even.hover .rtable-cell,[data-is="rtable"] .rtable-root.zebra .rtable-row.even.hover .rtable-cell{ background-color: #e1eff8; } rtable .rtable-root.zebra .rtable-row.odd .rtable-cell,[riot-tag="rtable"] .rtable-root.zebra .rtable-row.odd .rtable-cell,[data-is="rtable"] .rtable-root.zebra .rtable-row.odd .rtable-cell{ border-bottom:none; border-right:1px solid #ddd; } rtable .rtable-root.zebra .rtable-row.even.selected .rtable-cell,[riot-tag="rtable"] .rtable-root.zebra .rtable-row.even.selected .rtable-cell,[data-is="rtable"] .rtable-root.zebra .rtable-row.even.selected .rtable-cell{ background-color: #ffefd5; } rtable .rtable-root.zebra .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.zebra .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.zebra .rtable-header .rtable-cell{ background-color: #f2f2f2; } rtable .rtable-root.simple .rtable-row.even .rtable-cell,[riot-tag="rtable"] .rtable-root.simple .rtable-row.even .rtable-cell,[data-is="rtable"] .rtable-root.simple .rtable-row.even .rtable-cell{ } rtable .rtable-root.simple .rtable-row.even.hover .rtable-cell,[riot-tag="rtable"] .rtable-root.simple .rtable-row.even.hover .rtable-cell,[data-is="rtable"] .rtable-root.simple .rtable-row.even.hover .rtable-cell{ } rtable .rtable-root.simple .rtable-row.odd .rtable-cell,[riot-tag="rtable"] .rtable-root.simple .rtable-row.odd .rtable-cell,[data-is="rtable"] .rtable-root.simple .rtable-row.odd .rtable-cell{ } rtable .rtable-root.simple .rtable-row.even.selected .rtable-cell,[riot-tag="rtable"] .rtable-root.simple .rtable-row.even.selected .rtable-cell,[data-is="rtable"] .rtable-root.simple .rtable-row.even.selected .rtable-cell{ } rtable .rtable-root.simple .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.simple .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.simple .rtable-header .rtable-cell{ background-color: #f2f2f2; } rtable .rtable-root.table,[riot-tag="rtable"] .rtable-root.table,[data-is="rtable"] .rtable-root.table{ border: none; } rtable .rtable-root.table .rtable-row.even .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-row.even .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-row.even .rtable-cell{ } rtable .rtable-root.table .rtable-row.odd .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-row.odd .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-row.odd .rtable-cell{ } rtable .rtable-root.table .rtable-row.even.selected .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-row.even.selected .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-row.even.selected .rtable-cell{ background-color: #ffefd5; } rtable .rtable-root.table .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-header .rtable-cell{ } rtable .rtable-root.table .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-cell{ border-right:none; border-bottom:1px solid #ddd; } rtable .rtable-root.table .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.table .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.table .rtable-header .rtable-cell{ border-bottom: 2px solid #ddd; } rtable .rtable-root.table-striped,[riot-tag="rtable"] .rtable-root.table-striped,[data-is="rtable"] .rtable-root.table-striped{ border: none; } rtable .rtable-root.table-striped .rtable-row.even .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-row.even .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-row.even .rtable-cell{ background-color: #f9f9f9; border-bottom:none; } rtable .rtable-root.table-striped .rtable-row.even.hover .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-row.even.hover .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-row.even.hover .rtable-cell{ background-color: #e1eff8; } rtable .rtable-root.table-striped .rtable-row.odd .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-row.odd .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-row.odd .rtable-cell{ border-bottom:none; } rtable .rtable-root.table-striped .rtable-row.even.selected .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-row.even.selected .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-row.even.selected .rtable-cell{ } rtable .rtable-root.table-striped .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-header .rtable-cell{ } rtable .rtable-root.table-striped .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-cell{ border-right:none; border-bottom:1px solid #ddd; } rtable .rtable-root.table-striped .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-root.table-striped .rtable-header .rtable-cell,[data-is="rtable"] .rtable-root.table-striped .rtable-header .rtable-cell{ border-bottom: 2px solid #ddd; } rtable .rtable-notation,[riot-tag="rtable"] .rtable-notation,[data-is="rtable"] .rtable-notation{ border: 6px solid; border-color: transparent transparent transparent transparent; width: 0px; height: 0px; position: absolute; top: 0px; right: -5px; } rtable .rtable-notation.error,[riot-tag="rtable"] .rtable-notation.error,[data-is="rtable"] .rtable-notation.error{ border-color: #b94a48 #b94a48 transparent transparent; } rtable .rtable-notation.warning,[riot-tag="rtable"] .rtable-notation.warning,[data-is="rtable"] .rtable-notation.warning{ border-color: #f89406 #f89406 transparent transparent; } rtable .rtable-notation.success,[riot-tag="rtable"] .rtable-notation.success,[data-is="rtable"] .rtable-notation.success{ border-color: #468847 #468847 transparent transparent; } rtable .rtable-notation.info,[riot-tag="rtable"] .rtable-notation.info,[data-is="rtable"] .rtable-notation.info{ border-color: #3a87ad #3a87ad transparent transparent; }',"",function(t){function e(){var t,e={},r=navigator.userAgent.toLowerCase();return(t=r.match(/rv:([\d.]+)\) like gecko/))?e.ie=t[1]:(t=r.match(/msie ([\d.]+)/))?e.ie=t[1]:(t=r.match(/firefox\/([\d.]+)/))?e.firefox=t[1]:(t=r.match(/chrome\/([\d.]+)/))?e.chrome=t[1]:(t=r.match(/opera.([\d.]+)/))?e.opera=t[1]:(t=r.match(/version\/([\d.]+).*safari/))?e.safari=t[1]:0,e}function r(t,e){return e.x>t.left&&e.x<t.right&&e.y>t.top&&e.y<t.bottom}function l(t,e,r){t.style.width=e.right-e.left+"px","before"==r?(t.style.left=e.left+"px",t.style.top="0px",t.style.bottom=""):(t.style.top="",t.style.left=e.left+"px",t.style.bottom="0px")}function a(){var t,e,r=document.createElement("p"),l={width:"100px",height:"100px",overflowY:"scroll"};for(t in l)r.style[t]=l[t];return document.body.appendChild(r),e=r.offsetWidth-r.clientWidth,document.body.removeChild(r),e}function o(t,e,r){var l,a,o,i,s,n,h,c,b,p,g=[],f={};if(!t||0===t.length)return[];for(l=0;l<e;l++)g[l]=[],f[l]=0;for(l=0,a=t.length;l<a;l++)for(i=t[l],n=i.subs.length,c=1,o=0;o<n;o++){if(h=i.subs[o],b={},b.title=h.replace("%%","/"),o==n-1?(b.rowspan=e-(n-1)*c,b.leaf=!0):b.rowspan=c,b.colspan=1,b.level=o,b.col=l,b.width=i.width,b.height=b.rowspan*d.headerRowHeight,b.top=d.headerRowHeight*o,b.frozen=r,b.buttons=i.buttons,b.render=i.render,b.name=i.name,b.real_col=i,b.fixed=i.fixed,b.style=i.style,b.type=i.type,b.sort=i.sort,b.align=i.align||"left",b["class"]=i["class"],b.tag=i.tag||"rtable-raw",b.editor=i.editor,b.leaf=!0,i.headerTooltip&&("string"==typeof i.headerTooltip?b.tooltip=i.headerTooltip:"function"==typeof i.headerTooltip&&(b.tooltip=i.headerTooltip())),b.columnTooltip=i.columnTooltip,p=g[o].length>0?g[o][g[o].length-1]:null,p&&p.title==b.title&&p.level==b.level)p.colspan++,p.width+=b.width,f[o]+=b.width,p.leaf=!1;else for(g[o].push(b),b.left=f[o],f[o]+=b.width,s=1;s<b.rowspan;s++)f[o+s]+=b.width;i.left=b.left}var u=[];for(l=0;l<e;l++)u=u.concat(g[l]);return u}function s(t){return function(){return d[t].apply(d,arguments)}}function n(t){return function(){return d._data[t].apply(d._data,arguments)}}var d=this;if(this.observable=t.observable,this.root.instance=this,t.options)for(var h in t.options)t[h]=t.options[h];this.nameField=t.nameField||"name",this.titleField=t.titleField||"title",this.cols=t.cols.slice(),this.combineCols=t.combineCols||[],this.headerRowHeight=t.headerRowHeight||34,this.height=t.height||"auto",this.rowHeight=t.rowHeight||34,this.indexColWidth=t.indexColWidth||40,this.indexColFrozen=t.indexColFrozen||!1,this.checkColWidth=t.checkColWidth||30,this.checkColFrozen=t.checkColFrozen||!1,this.multiSelect=t.multiSelect||!1,this.visCells=[],this.sort_cols=[],this.clickSelect=void 0===t.clickSelect?"row":t.clickSelect,this.noData=t.noData||"No Data",this.loading=t.loading||'Loading... <i class="fa fa-spinner fa-pulse fa-spin"></i>',this.container=t.container||$(this.root).parent(),this.editable=t.editable||!1,this.draggable=t.draggable||!1,this.theme=t.theme||"zebra",this.minColWidth=t.minColWidth||5,this.contextMenu=t.contextMenu||[],this.virtual=t.virtual||!1,this.minColWidth=t.minColWidth||100,this.onUpdate=t.onUpdate||function(){},this.onSort=t.onSort||function(){},this.onRowClass=t.onRowClass||function(){},this.onEdit=t.onEdit||function(){return!0},this.onEdited=t.onEdited||function(){return!0},this.onSelected=t.onSelected||function(){},this.onSelect=t.onSelect||function(){return!0},this.onDeselected=t.onDeselected||function(){},this.onLoadData=t.onLoadData||function(t){},this.onCheckable=t.onCheckable||function(t){return!0},this.onEditable=t.onEditable||function(t,e){return d.editable},this.tree=t.tree,this.showIcon=void 0===t.showIcon||t.showIcon,t.useFontAwesome?(this.openIcon=t.openIcon||'<i class="fa fa-minus-square-o"></i>',this.closeIcon=t.closeIcon||'<i class="fa fa-plus-square-o"></i>'):(this.openIcon=t.openIcon||"-",this.closeIcon=t.closeIcon||"+"),this.iconInden=16,this.expanded=void 0!==t.expanded&&t.expanded,this.idField=t.idField||"id",this.parentField=t.parentField||"parent",this.orderField=t.orderField||"order",this.levelField=t.levelField||"level",this.hasChildrenField=t.hasChildrenField||"has_children",this.indentWidth=16,this.colspanValue=t.colspanValue||"--",this.selected_rows=[],this.parents_expand_status={},this.loaded_status={},this.notations={};var c,b={tree:t.tree,idField:this.idField,parentField:this.parentField,levelField:this.levelField,orderField:this.orderField,hasChildrenField:this.hasChildrenField};if(t.data){if(Array.isArray(t.data))this._data=new DataSet,c=t.data;else{var c=t.data.get();this._data=t.data}t.tree?(this._data.setOption(b),this._data.load_tree(c,{parentField:this.parentField,orderField:this.orderField,levelField:this.levelField,hasChildrenField:this.hasChildrenField,plain:!0})):this._data.load(c)}else this._data=new DataSet(b);this.show_loading=function(t){t?($(this.root).find(".rtable-loading").html(this.loading).show(),$(this.root).find(".rtable-nodata").hide()):$(this.root).find(".rtable-loading").hide()},this.load_clear=function(){d.selected_rows=[],d.parents_expand_status={},d.loaded_status={},d.notations={}},this.bind=function(){d._data.on("*",function(t,e){if(d.onUpdate(d._data,t,e),"remove"==t)for(var r,l=e.items,a=0,o=l.length;a<o;a++)r=d.selected_rows.indexOf(l[a].id),r!==-1&&d.selected_rows.splice(r,1);return"loading"==t?(d.show_loading(!0),void d.load_clear()):("load"==t&&d.show_loading(!1),d.ready_data(),d.calData(),void d.update())})},this.ready_data=function(){var e=[];if(t.tree||t.remoteSort||!this.sort_cols.length)this.rows=this._data.get();else{for(i=0,len=this.sort_cols.length;i<len;i++)col=this.sort_cols[i],"desc"==col.direction?e.push("-"+col.name):"asc"==col.direction&&e.push(col.name);this.rows=this._data.get({order:e})}},this.on("mount",function(){this.content=this.root.querySelectorAll(".rtable-body.rtable-main")[0],this.header=this.root.querySelectorAll(".rtable-header.rtable-main")[0],this.content_fixed=this.root.querySelectorAll(".rtable-body.rtable-fixed")[0],this.browser=e(),this._updated=!1,window.addEventListener("resize",function(){"auto"!=t.width&&t.width&&t.height||d.resize()}),this.content.addEventListener("scroll",function(t){d.scrolling(t)},{passive:!0}),$(this.content).on("click",".rtable-cell",this.click_handler).on("dblclick",".rtable-cell",this.dblclick_handler),$(this.content).on("mouseenter",".rtable-row",this.hover_handler1).on("mouseleave",".rtable-row",this.hover_handler2),$(this.content_fixed).on("click",".rtable-cell",this.click_handler).on("dblclick",".rtable-cell",this.dblclick_handler),$(this.content_fixed).on("hover",".rtable-cell",this.hover_handler).on("mouseleave",".rtable-row",this.hover_handler2),this.dnd(),this.bind_contextmenu(),this.scrollbar_width=a(),this.ready_data(),this.calSize(),this.calHeader(),this.calData(),this.bind(),this.update()}),this.hover_handler1=function(t){var e=$(this).index();$(d.content_fixed).find(".rtable-row:eq("+e+")").addClass("hover"),$(d.content).find(".rtable-row:eq("+e+")").addClass("hover")},this.hover_handler2=function(t){var e=$(this).index();$(d.content_fixed).find(".rtable-row:eq("+e+")").removeClass("hover"),$(d.content).find(".rtable-row:eq("+e+")").removeClass("hover")},this.dnd=function(t){var e=$(this.root);t&&(e.off("dragstart",".rtable-cell-text[draggable]",this.handleDragStart).off("dragover",".rtable-cell-text[draggable]",this.handleDragOver).off("drop",".rtable-cell-text[draggable]",this.handleDrop),this.browser.ie&&e.off("selectstart",".rtable-cell-text[draggable]",this.handleSelectStart)),this.draggable&&(e.on("dragstart",".rtable-cell-text[draggable]",this.handleDragStart).on("dragover",".rtable-cell-text[draggable]",this.handleDragOver).on("drop",".rtable-cell-text[draggable]",this.handleDrop),this.browser.ie&&e.on("selectstart",".rtable-cell-text[draggable]",this.handleSelectStart))},this.handleDragStart=function(t){var e=t.target._tag.opts.col;d.drag_start_element=t.target,d.drag_src=e.row,t.originalEvent.dataTransfer.effectAllowed="move"},this.handleSelectStart=function(t){return t.preventDefault(),t.stopPropagation(),this.dragDrop(),!1},this.handleDragOver=function(t){if(t.preventDefault&&t.preventDefault(),!t.target.isSameNode(d.drag_start_element)&&t.target._tag){var e=t.target._tag.opts.col;if(!e.treeField)return!1;var a,o,i,s=e.width,n=e.height,h=t.target.querySelector(".rtable-draggable-helper");if(d._data.isChild(e.row,d.drag_src))return!1;a={top:0,left:0,right:s,bottom:n/2},o={top:n/2,left:0,right:2*s/5,bottom:n},i={top:n/2,left:2*s/5,right:s,bottom:n};var c={x:t.originalEvent.offsetX,y:t.originalEvent.offsetY},b=r(a,c),p=r(o,c),g=r(i,c);return(b||p||g)&&(h||(h=document.createElement("div"),h.style.position="absolute",h.className="rtable-draggable-helper",h.style.zIndex=1e3,h.style.borderTop="2px solid green",t.target.appendChild(h),d.drag_helper&&($(d.drag_helper).remove(),d.drag_helper=null),d.drag_helper=h),b&&"before"!=d.drag_last_pos?(d.drag_last_pos="before",l(h,a,d.drag_last_pos)):p&&"after"!=d.drag_last_pos?(d.drag_last_pos="after",l(h,o,d.drag_last_pos)):g&&(d.drag_last_pos="child",l(h,i,d.drag_last_pos))),e=t.target._tag.opts.col,t.originalEvent.dataTransfer.dropEffect="move",!1}},this.handleDrop=function(t){var e=d.drag_last_pos;if(e&&(d.drag_helper&&($(d.drag_helper).remove(),d.drag_helper=null,d.drag_last_pos=""),t.currentTarget._tag)){var r=t.currentTarget._tag.opts.col,l=d.drag_src,a=r.row;d.opts.onMove&&d.opts.onMove(l,a,e)}},this.bind_contextmenu=function(){for(var t=0,e=this.contextMenu.length;t<e;t++)item=this.contextMenu[t],item._fn=item.fn;var r=function(t,e){for(var r,l=0,a=d.contextMenu.length;l<a;l++){r=d.contextMenu[l];var o=function(t,e,r){return function(){t._fn.call(d,e,r)}};"separator"!=r.type&&(r.fn=o(r,t,e))}};$(this.content).on("contextmenu",".rtable-cell",function(t){var e=t.target._tag.opts.col,l=e.row;d.select(l),d.update(),t.preventDefault(),r(l,e),basicContext.show(d.contextMenu,t)})},this.on("updated",function(){this._updated||(this._updated=!0,this.resize())}),this.click_handler=function(e){var r,l=e.target._tag;if((!d.editable||!d.editor)&&l){var a=l.opts.col;t.onClick&&(r=t.onClick(a.row,a)),!r&&$(e.target).hasClass("rtable-cell-text")&&(e.preventDefault(),"row"===d.clickSelect?(d.toggle_select(a.row),d.update()):"column"===d.clickSelect)}},this.dblclick_handler=function(e){var r,l,a=$(e.target);if(l=a.hasClass("rtable-cell-text")?e.target:a.parents(".rtable-cell-text")[0]){var o=l._tag;if(o){var i=l._tag.opts.col;if(t.onDblclick&&(r=t.onDblclick(i.row,i)),!r&&(e.preventDefault(),t.editable)){if(!i.editor)return;if(!d.onEditable(i.row,i))return;e.preventUpdate=!0,document.selection&&document.selection.empty&&(document.selection.empty(),1)||window.getSelection&&window.getSelection().removeAllRanges(),g($(l).parent()[0],i.row,i)}}}},this.sort_handler=function(e){var r,l,a;e.preventDefault(),r=e.item.name,0==d.sort_cols.length?l="asc":(a=d.sort_cols[0],l="desc"!=a.direction&&("asc"==a.direction?"desc":"asc")),l?d.sort_cols=[{name:r,direction:l}]:d.sort_cols=[],t.remoteSort?d.onSort.call(d,d.sort_cols):(d.ready_data(),d.calData())},this.get_sort_top=function(t){var e;return e="asc"==t?(d.headerRowHeight-16)/2+4:"desc"==t?(d.headerRowHeight-16)/2+2:(d.headerRowHeight-16)/2+4},this.colresize=function(t){var e,r=t.clientX,l=$(this.header),a=$(document),o=t.item,i=o.width;document.selection&&document.selection.empty&&(document.selection.empty(),1)||window.getSelection&&window.getSelection().removeAllRanges(),document.body.onselectstart=function(){return!1},l.css("-moz-user-select","none"),a.on("mousemove",function(t){e=Math.max(i+t.clientX-r,d.minColWidth),o.real_col.width=e,d.resize()}).on("mouseup",function(t){document.body.onselectstart=function(){return!0},l.css("-moz-user-select","text"),a.off("mousemove").off("mouseup")})},this.on("update",function(){this.start=t.start||0,this.content&&this.calVis()}),this.calHeader=function(){var e,r,l,a,i,s,n,h,c=[],b=[],p=[],g=0,f=!1;s=0;for(var u=0,w=d.cols.length;u<w&&("__index_col__"==d.cols[u][d.nameField]?n=!0:"__check_col__"==d.cols[u][d.nameField]&&(h=!0),this.cols[u].frozen&&(f=!0),!(n&&h&&f));u++);for(f=f||this.indexColFrozen||this.checkColFrozen,t.indexCol&&!n&&(i={render:function(t,e,r){return e.index+1},width:d.indexColWidth,frozen:f,align:"center"},i[this.nameField]="__index_col__",i[this.titleField]="#",this.cols.unshift(i)),t.checkCol&&!h&&(i={type:"check",width:d.checkColWidth,align:"center",frozen:f},i[this.nameField]="__check_col__",i[this.titleField]="_check",t.indexCol?this.cols.splice(1,0,i):this.cols.unshift(i)),l=0,a=this.cols.length;l<a;l++)i=this.cols[l],i.hidden||(i.frozen?c.push(i):b.push(i),i.name=i[this.nameField],i.title=i[this.titleField]||i.name,i.subs=i.title.split("/"),s=Math.max(s,i.subs.length),i.width?g+=i.width:p.push(i));if(this.max_level=s,this.header_height=s*this.headerRowHeight,this.calData(),this.rowHeight*this.rows.length>this.height-this.header_height?this.yscroll_fix=this.scrollbar_width:this.yscroll_fix=0,p.length>0){var _,x,v=this.width-g-this.yscroll_fix;x=this.minColWidth*p.length,v>=x?_=Math.floor(v/p.length):(_=this.minColWidth,v=x);for(var l=0,a=p.length;l<a;l++)p[l].width=_,l==p.length-1&&(p[l].width=v-(p.length-1)*_)}e=o(b,s,!1),r=o(c,s,!0),this.fix_cols=c,this.main_cols=b,this.fix_columns=r,this.main_columns=e,this.max_level=s;for(var i,m=0,y=0,l=0,a=this.cols.length;l<a;l++)i=this.cols[l],i.hidden||(i.frozen?m+=i.width:y+=i.width);this.fix_width=m,this.main_width=y,this.main_width>this.width-this.fix_width?this.xscroll_fix=this.scrollbar_width:this.xscroll_fix=0},this.calSize=function(){"auto"!==t.width&&t.width?this.width=t.width:this.width=$(this.container).width(),t.height?"auto"==t.height||(this.height=t.height):this.height=$(this.container).height()},this.calScrollbar=function(){this.has_yscroll=this.content.scrollHeight>this.content.clientHeight||this.rows.length*this.rowHeight>this.height-this.header_height,this.has_xscroll=this.content.scrollWidth>this.content.clientWidth||this.main_width>this.width-this.fix_width,this.xscroll_width=this.has_xscroll?this.scrollbar_width:0,this.yscroll_width=this.has_yscroll?this.scrollbar_width:0},this.calData=function(){"auto"==t.height&&(this.height=Math.max(1,this.rows.length)*this.rowHeight+this.header_height,t.maxHeight&&(this.height=Math.min(t.maxHeight,this.height)),0==this.rows.length&&t.minHeight&&(this.height=Math.max(t.minHeight,this.height)))},this.calVis=function(){function e(t,e){if(!d.tree)return!1;var r,l,a,o=[];if(r=e[d.parentField],!r)return!1;for(;r;){if(y.hasOwnProperty(r))return y[r];if(!d.opened(r)){for(y[r]=!0,l=0,a=o.length;l<a;l++)y[o[l]]=!0;return!0}o.push(r),r=d._data.get(r)[d.parentField]}for(l=0,a=o.length;l<a;l++)y[o[l]]=!1}var r,l,a,o,i,s,n,h,c,b,p,g,f,u,w,_,x,v,m,y={};f={},f.top=this.content.scrollTop,f.left=this.content.scrollLeft,f.bottom=f.top+this.height-this.header_height-this.scrollbar_width,f.right=f.left+this.width-this.fix_width-this.scrollbar_width,this.virtual?(first=Math.max(Math.floor(this.content.scrollTop/this.rowHeight),0),a=Math.ceil((this.content.scrollTop+this.height-this.header_height)/this.rowHeight)):(first=0,a=this.rows.length);(new Date).getTime();o=a-first,u=[],w=[],g=this.rowHeight,s=this.fix_columns.concat(this.main_columns);var k={},C={},F=[];for(var z in this.combineCols)C[z]=-1,F.push(!1);for(r=0,b=0;r<this.rows.length;)if(n=this.rows[r],e(this.rows,n))r++;else{if(b>=first)break;r++,b++}for(b=0;b<o&&r<this.rows.length;)if(n=this.rows[r],e(this.rows,n))r++;else{for(_={row:n,cols:[],line:first+b},x={row:n,cols:[],line:first+b},u.push(_),w.push(x),p=g*(first+b),l=0,i=s.length;l<i;l++)if(h=s[l],h.leaf)if(n[h.name]!=this.colspanValue){if(c={top:p,width:h.width,height:g,left:h.left,row:n,style:h.style,type:h.type,selected:this.is_selected(n),render:h.render,buttons:h.buttons,index:first+this.start+b,sor:h.sort,align:h.align,"class":h["class"],tag:h.tag,editor:h.editor,name:h.name,
notation:this.get_col_notation(n,h)},m=c,t.treeField==h.name&&t.tree&&(v=n.level||0,n.has_children&&(d.opened(n)?c.expander=d.openIcon:c.expander=d.closeIcon),c.treeField=!0,v++,c.indent=v*d.indentWidth,c.indentWidth="padding-left:"+c.indent+"px"),c.value=n[h.name],c.__value__=this.get_col_data(c,n[h.name]),h.columnTooltip&&("string"==typeof h.columnTooltip&&(c.tooltip=h.columnTooltip),"function"==typeof h.columnTooltip&&(c.tooltip=h.columnTooltip(n,c,c.value))),this.combineCols.indexOf(h.name)>-1){var D=this.combineCols.indexOf(h.name),S=!(D-1>=0)||F[D-1];S&&k[h.name]&&k[h.name].value==c.value?(F[D]=!0,c.height=0,k[h.name].height+=g):(F[D]=!1,C[h.name]=first+r,k[h.name]=c)}h.frozen?x.cols.push(c):this.virtual?c.left>f.right||c.right<f.left||_.cols.push(c):_.cols.push(c)}else m.width+=h.width;r++,b++}this.visCells={fixed:w,main:u}},this.get_col_notation=function(t,e){var r=t.id+":"+e.name;return this.notations[r]||null},this.set_notation=function(t,e,r){var l=this.getId(t),a=l+":"+e;this.notations[a]=r},this.get_sorted=function(t){for(var e,r=0,l=this.sort_cols.length;r<l;r++)if(e=this.sort_cols[r],e.name==t&&e.direction)return"fa-sort-"+e.direction;return"fa-sort"},this.getId=function(t){return d._data.getId(t)},this.toggle_expand=function(t){var e=d.getId(t.item.col.row),r=d.parents_expand_status[e];void 0===r&&(r=!0),d._expand(t.item.col.row,!r)},this.expand=function(t){d._expand(t,!0),d.update()},this.collapse=function(t){d._expand(t,!1),d.update()},this._expand=function(t,e){var r,l,a,o=this;if(t)if(Array.isArray(t))for(r=0,l=t.length;r<l;r++)a=o.getId(t[r]),o.parents_expand_status.hasOwnProperty(a)&&(o.parents_expand_status[a]=e),e&&o.load_node(o._data.get(a));else a=o.getId(t),o.parents_expand_status.hasOwnProperty(a)&&(o.parents_expand_status[a]=e),e&&o.load_node(o._data.get(a));else for(a in o.parents_expand_status)o.parents_expand_status[a]=e,e&&o.load_node(o._data.get(a))},this.load_node=function(t){var e=d.getId(t),r=d.loaded_status[e];if(t[d.hasChildrenField]&&!r)return d._data.has_child(t)?void(d.loaded_status[t[d.idField]]=!0):void d.onLoadData.call(d,t)},this.opened=function(t){var e,r;return e=t instanceof Object?t.id:t,r=d.parents_expand_status[e],r===!0||r!==!1&&(d.parents_expand_status[e]=d.expanded,d.parents_expand_status[e])},this.scrolling=function(t){if(d.header.scrollLeft=d.content.scrollLeft,d.content_fixed.scrollTop=d.content.scrollTop,this.virtual)return d.update()};var p=function(t){var e=10,r=40,l=800,a=0,o=0,i=0,s=0;return"detail"in t&&(o=t.detail),"wheelDelta"in t&&(o=-t.wheelDelta/120),"wheelDeltaY"in t&&(o=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(a=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(a=o,o=0),i=a*e,s=o*e,"deltaY"in t&&(s=t.deltaY),"deltaX"in t&&(i=t.deltaX),(i||s)&&t.deltaMode&&(1==t.deltaMode?(i*=r,s*=r):(i*=l,s*=l)),i&&!a&&(a=i<1?-1:1),s&&!o&&(o=s<1?-1:1),{spinX:a,spinY:o,pixelX:i,pixelY:s}};this.mousewheel=function(t){var e=p(event);if(Math.abs(e.pixelX)>Math.abs(e.pixelY)){var r=this.header.scrollLeft,l=this.content.scrollLeft;return this.header.scrollLeft=this.header.scrollLeft+e.pixelX,this.content.scrollLeft=this.content.scrollLeft+e.pixelX,r!=this.header.scrollLeft||l!=this.content.scrollLeft}if(e.pixelY){var a=this.header.scrollTop,o=this.content.scrollTop;return this.header.scrollTop=this.header.scrollTop+e.pixelY,this.content.scrollTop=this.content.scrollTop+e.pixelY,a!=this.header.scrollTop||o!=this.content.scrollTop}return!1},this.checkall=function(t){t.preventUpdate=!0;var e=!0;d.selected_rows.length>0&&(e=!1);for(var r=d._data.getIds(),l=0,a=r.length;l<a;l++)e?d.select(d._data.get(r[l])):d.deselect(d._data.get(r[l]));d.update()},this.checkcol=function(t){d.toggle_select(t.item.col.row),t.target.checked=d.is_selected(t.item.col.row)},this.toggle_select=function(t){this.is_selected(t)?d.deselect(t):d.select(t)},this.select=function(e){var r,l;e||(e=this._data.get()),Array.isArray(e)||(e=[e]);for(var a=0,o=e.length;a<o;a++){if(r=e[a],!d.onCheckable(r))return;l=r instanceof Object?r.id:r,this.selected_rows.indexOf(l)==-1&&this.onSelect(r)&&(t.multiSelect||(d.selected_rows=[]),this.selected_rows.push(l),this.onSelected(r),this.observable&&this.observable.trigger("selected",r))}},this.deselect=function(t){var e,r,l,a=this.selected_rows,o=[];if(t){Array.isArray(t)||(t=[t]);for(var i=0,s=t.length;i<s;i++)l=t[i]instanceof Object?t[i].id:t[i],o.push(l);for(var i=a.length-1;i>-1;i--){if(e=a[i],!d.onCheckable(this._data.get(e)))return;if(r=o.indexOf(e),r!=-1&&(a.splice(i,1),o.splice(r,1),this.onDeselected(this._data.get(e)),this.observable&&this.observable.trigger("deselected",this._data.get(e))),0==t.length)break}}else this.selected_rows=[],this.onDeselected(),this.observable&&this.observable.trigger("deselected")},this.is_selected=function(t){var e;if(t)return e=t instanceof Object?t.id:t,d.selected_rows.indexOf(e)!==-1},this.root.is_selected=s("is_selected"),this.get_selected=function(){return this._data.get({filter:function(t){return d.selected_rows.indexOf(t.id)!==-1}})},this.root.get_selected=s("get_selected"),this.root.expand=s("expand"),this.root.collapse=s("collapse"),this.root.show_loading=s("show_loading"),this.resize=function(){d.calSize(),d.calHeader(),d.calData(),d.header.scrollLeft=d.content.scrollLeft,d.content_fixed.scrollTop=d.content.scrollTop,d.update()},this.root.add=n("add"),this.root.addFirstChild=n("addFirstChild"),this.root.update=n("update"),this.root.remove=n("remove"),this.root.get=n("get"),this.root.load=n("load"),this.root.insertBefore=n("insertBefore"),this.root.insertAfter=n("insertAfter"),this.root.move=function(){var t=d._data.move.apply(d._data,arguments);return d.expand(arguments[1]),t},this.root.diff=n("diff"),this.root.save=n("save"),this.root.refresh=s("update"),this.root.set_notation=s("set_notation"),this.root.setData=function(t){d._data=t,d.bind()}.bind(this),this.get_col_data=function(t,e){return t.render&&"function"==typeof t.render&&(e=t.render(t.row,t,e)),e||""},this.action_click=function(t,e){return function(r){e.onclick&&"function"==typeof e.onclick&&e.onclick.call(r.target,t.row,d.root)}},this.get_cell_class=function(t){var e,r=[];return r.push("rtable-cell"),t.selected&&r.push("selected"),t["class"]&&(e="function"==typeof t["class"]?t["class"](t.row,t,t.value):t["class"],e&&r.push(e)),r.join(" ")},this.get_row_class=function(t,e){var r,l=[];return l.push("rtable-row"),e%2==1?l.push("even"):l.push("odd"),r=this.onRowClass(t,e),r&&l.push(r),this.is_selected(t)&&l.push("selected"),l.join(" ")},this.addClass=function(t,e){var r=this[t].split(/\s+/);r.indexOf(e)<0&&r.push(e),this[t]=r.join(" ")},this.removeClass=function(t,e){if(this.hasClass(t,e)){var r=this[t].split(/\s+/);r.splice(r.indexOf(e),1),this[t]=r.join(" ")}},this.hasClass=function(t,e){return this[t].split(/\s+/).indexOf(e)>-1},this.testing=function(){return console.log("testing",arguments),!0};var g=function(t,e,r){var l;l="string"==typeof r.editor?r.editor:r.editor.name,d.editor&&(d.editor.destroy(),d.editor=null);var a=window[l+"_editor"];a&&$.when(d.onEdit()).then(function(l){l&&(d.editor=a.call(d,t,e,r))})}}),riot.tag2("rtable-cell",'<div class="rtable-cell-text {rtable-tree-field:opts.col.treeField}" draggable="{parent.draggable && (!parent.tree || parent.tree && opts.col.treeField) ? ⁗true⁗ : false}"> <yield></yield> </div>','rtable-cell [draggable],[riot-tag="rtable-cell"] [draggable],[data-is="rtable-cell"] [draggable]{ -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; user-select: none; -khtml-user-drag: element; -webkit-user-drag: element; }','class="rtable-cell-text-wrapper"',function(t){this.prevtag=null,this.on("mount",function(){!t.tag}),this.on("update",function(){$.extend({},t);this.mountedTag&&this.mountedTag.unmount(!0);var e=this.mountedTag=riot.mount(this.root.querySelector("div"),t.tag,t)[0];return e}),this.on("unmount",function(){if(this.mountedTag)return this.mountedTag.unmount(!0)})}),riot.tag2("rtable-raw","<span></span>","","",function(t){this.on("mount",function(){this.root.innerHTML=t.value}),this.on("update",function(){this.root.innerHTML=t.value})});