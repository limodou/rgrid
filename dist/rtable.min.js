riot.tag2("rtable",'<yield></yield> <div class="rtable-root" riot-style="width:{width-1}px;height:{height-1}px"> <div class="rtable-header rtable-fixed" riot-style="width:{fix_width}px;height:{header_height}px"> <div each="{fix_columns}" no-reorder class="{rtable-cell:true}" riot-style="width:{width}px;height:{height}px;left:{left}px;top:{top}px;line-height:{height}px;"> <div if="{type!=\'check\'}" data-is="raw" content="{title}" riot-style="{sort?\'padding-right:22px\':\'\'}"></div> <input if="{type==\'check\' && parent.multiSelect}" type="checkbox" onclick="{checkall}" class="rtable-check" riot-style="margin-top:{rowHeight/2-7}px" __checked="{parent.selected_rows.length>0}"></input> <div if="{!fixed && leaf}" class="rtable-resizer" onmousedown="{colresize}"></div> <div if="{sort}" class="{rtable-sort:true, desc:get_sorted(name)==\'desc\', asc:get_sorted(name)==\'asc\'}" title="{sort}" onclick="{sort_handler}" riot-style="top:{get_sort_top(get_sorted(name))}px"></div> </div> </div> <div class="rtable-header rtable-main" riot-style="width:{width-fix_width-xscroll_width}px;right:0px;height:{header_height}px;left:{fix_width}px;"> <div each="{main_columns}" no-reorder class="{rtable-cell:true}" riot-style="width:{width}px;height:{height}px;left:{left}px;top:{top}px;line-height:{height}px;"> <div if="{type!=\'check\'}" data-is="raw" content="{title}" riot-style="{sort?\'padding-right:22px\':\'\'}"></div> <input if="{type==\'check\' && parent.multiSelect}" type="checkbox" onclick="{checkall}" class="rtable-check" riot-style="margin-top:{rowHeight/2-7}px" __checked="{parent.selected_rows.length>0}"></input> <div if="{!fixed && leaf}" class="rtable-resizer" onmousedown="{colresize}"></div> <div if="{sort}" class="{rtable-sort:true, desc:get_sorted(name)==\'desc\', asc:get_sorted(name)==\'asc\'}" title="{sort}" onclick="{sort_handler}" riot-style="top:{get_sort_top(get_sorted(name))}px;"></div> </div> </div> <div class="rtable-body rtable-fixed" riot-style="width:{fix_width}px;bottom:{xscroll_width}px;top:{header_height}px;height:{height-header_height-xscroll_width}px;"> <div class="rtable-content" riot-style="width:{fix_width}px;height:{rows.length*rowHeight}px;"> <div each="{row in visCells.fixed}" no-reorder class="{get_row_class(row.row, row.line)}"> <div each="{col in row.cols}" no-reorder class="{get_cell_class(col)}" riot-style="width:{col.width}px;height:{col.height}px;left:{col.left}px;top:{col.top}px;line-height:{col.height}px;text-align:{col.align};"> <div if="{col.type!=\'check\' && !col.buttons}" data-is="raw" content="{col.value}" class="rtable-cell-text" onclick="{parent.click_handler}"></div> <input if="{col.type==\'check\'}" type="checkbox" onclick="{checkcol}" __checked="{col.selected}" class="rtable-check" riot-style="margin-top:{rowHeight/2-7}px"></input> </div> </div> </div> </div> <div class="rtable-body rtable-main" onscroll="{scrolling}" riot-style="left:{fix_width}px;top:{header_height}px;bottom:0px;right:0px;width:{width-fix_width+yscroll_fix}px;height:{height-header_height+xscroll_fix}px;"> <div class="rtable-content" riot-style="width:{main_width}px;height:{rows.length*rowHeight}px;"> <div each="{row in visCells.main}" no-reorder class="{get_row_class(row.row, row.line)}"> <div each="{col in row.cols}" no-reorder class="{get_cell_class(col)}" riot-style="width:{col.width}px;height:{col.height}px;left:{col.left}px;top:{col.top}px;line-height:{col.height}px;text-align:{col.align};"> <div if="{col.type!=\'check\' && !col.buttons}" data-is="raw" content="{col.value}" class="rtable-cell-text" onclick="{parent.click_handler}"></div> <input if="{col.type==\'check\'}" type="checkbox" onclick="{checkcol}" __checked="{col.selected}" class="rtable-check" riot-style="margin-top:{rowHeight/2-7}px;"></input> <virtual if="{col.buttons}" no-reorder each="{btn in col.buttons}"> <i if="{btn.icon}" class="fa fa-{btn.icon} action" title="{btn.title}" onclick="{parent.parent.action_click(parent.col, btn)}"></i> <a if="{btn.label}" class="action" title="{btn.title}" href="{btn.href || \'#\'}" onclick="{parent.parent.action_click(parent.col, btn)}">{btn.label}</a> </virtual> </div> </div> </div> </div> <div if="{rows.length==0}" data-is="raw" content="{noData}" class="rtable-nodata"></div> </div> </div>','rtable .action,[riot-tag="rtable"] .action,[data-is="rtable"] .action{cursor:pointer;} rtable .rtable-root,[riot-tag="rtable"] .rtable-root,[data-is="rtable"] .rtable-root{ position:relative; border: 1px solid gray; overflow:hidden; } rtable .rtable-header,[riot-tag="rtable"] .rtable-header,[data-is="rtable"] .rtable-header{ position:absolute; box-sizing: border-box; } rtable .rtable-header.rtable-fixed,[riot-tag="rtable"] .rtable-header.rtable-fixed,[data-is="rtable"] .rtable-header.rtable-fixed{ left:0; top:0; } rtable .rtable-header.rtable-main,[riot-tag="rtable"] .rtable-header.rtable-main,[data-is="rtable"] .rtable-header.rtable-main{ top:0; overflow:hidden; } rtable .rtable-cell,[riot-tag="rtable"] .rtable-cell,[data-is="rtable"] .rtable-cell{ position:absolute; box-sizing: border-box; border-right:1px solid gray; border-bottom:1px solid gray; background-color: white; padding-left:4px; padding-right:4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } rtable .rtable-cell>*,[riot-tag="rtable"] .rtable-cell>*,[data-is="rtable"] .rtable-cell>*{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } rtable .rtable-cell > .rtable-resizer,[riot-tag="rtable"] .rtable-cell > .rtable-resizer,[data-is="rtable"] .rtable-cell > .rtable-resizer{ width:4px; position:absolute; height:100%; cursor: col-resize; top:0px; right:0px; } rtable .rtable-cell.selected,[riot-tag="rtable"] .rtable-cell.selected,[data-is="rtable"] .rtable-cell.selected{ background-color:#ffefd5; } rtable .rtable-cell .rtable-check,[riot-tag="rtable"] .rtable-cell .rtable-check,[data-is="rtable"] .rtable-cell .rtable-check{ vertical-align: text-bottom; margin-top: 5px; } rtable .rtable-cell .rtable-sort,[riot-tag="rtable"] .rtable-cell .rtable-sort,[data-is="rtable"] .rtable-cell .rtable-sort,rtable .rtable-cell .rtable-sort.desc,[riot-tag="rtable"] .rtable-cell .rtable-sort.desc,[data-is="rtable"] .rtable-cell .rtable-sort.desc,rtable .rtable-cell .rtable-sort.asc,[riot-tag="rtable"] .rtable-cell .rtable-sort.asc,[data-is="rtable"] .rtable-cell .rtable-sort.asc{ position: absolute; display: block; content: ""; background-color: transparent; border-left: 1px solid #ccc; border-bottom: 1px solid #ccc; height: 8px; width: 8px; right: 6px; top:6px; z-index: 102; cursor: pointer; -webkit-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); } rtable .rtable-cell .rtable-sort.desc,[riot-tag="rtable"] .rtable-cell .rtable-sort.desc,[data-is="rtable"] .rtable-cell .rtable-sort.desc{ border-left: 1px solid black; border-bottom: 1px solid black; -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); -o-transform: rotate(-45deg); transform: rotate(-45deg); } rtable .rtable-cell .rtable-sort.asc,[riot-tag="rtable"] .rtable-cell .rtable-sort.asc,[data-is="rtable"] .rtable-cell .rtable-sort.asc{ border-left: 1px solid black; border-bottom: 1px solid black; -webkit-transform: rotate(135deg); -ms-transform: rotate(135deg); -o-transform: rotate(135deg); transform: rotate(135deg); } rtable .rtable-header .rtable-cell,[riot-tag="rtable"] .rtable-header .rtable-cell,[data-is="rtable"] .rtable-header .rtable-cell{ text-align:center; vertical-align: middle; } rtable .rtable-body,[riot-tag="rtable"] .rtable-body,[data-is="rtable"] .rtable-body{ position:absolute; box-sizing: border-box; } rtable .rtable-body.rtable-fixed,[riot-tag="rtable"] .rtable-body.rtable-fixed,[data-is="rtable"] .rtable-body.rtable-fixed{ left:0; overflow: hidden; } rtable .rtable-body.rtable-main,[riot-tag="rtable"] .rtable-body.rtable-main,[data-is="rtable"] .rtable-body.rtable-main{ overflow: auto; } rtable .rtable-nodata,[riot-tag="rtable"] .rtable-nodata,[data-is="rtable"] .rtable-nodata{ position: absolute; top: 0; bottom: 0; left: 0; right: 0; margin: auto; height: 34px; width: 150px; text-align: center; border:1px solid #ccc; color: #ccc; line-height: 34px; border-radius: 3px; }',"",function(t){function e(){var t,e={},i=navigator.userAgent.toLowerCase();return(t=i.match(/rv:([\d.]+)\) like gecko/))?e.ie=t[1]:(t=i.match(/msie ([\d.]+)/))?e.ie=t[1]:(t=i.match(/firefox\/([\d.]+)/))?e.firefox=t[1]:(t=i.match(/chrome\/([\d.]+)/))?e.chrome=t[1]:(t=i.match(/opera.([\d.]+)/))?e.opera=t[1]:(t=i.match(/version\/([\d.]+).*safari/))?e.safari=t[1]:0,e}function l(){var t,e,i=document.createElement("p"),l={width:"100px",height:"100px",overflowY:"scroll"};for(t in l)i.style[t]=l[t];return document.body.appendChild(i),e=i.offsetWidth-i.clientWidth,document.body.removeChild(i),e}function r(t,e,i){var l,r,o,a,c,h,n,d,b,p,f,g=[];if(!t||0===t.length)return[];for(l=0;l<e;l++)g.push([]);for(l=0,r=t.length;l<r;l++)for(a=t[l],c=a.subs.length,n=1,p=-1,o=0;o<c;o++)h=a.subs[o],b={},b.title=h,o==c-1?(b.rowspan=e-(c-1)*n,b.leaf=!0):b.rowspan=n,b.colspan=1,b.level=o,b.col=l,b.width=a.width,b.height=b.rowspan*s.rowHeight,b.top=s.rowHeight*o,b.frozen=i,b.buttons=a.buttons,b.render=a.render,b.name=a.name,b.real_col=a,b.fixed=a.fixed,b.style=a.style,b.type=a.type,b.sort=a.sort,b.align=a.align||"left",b["class"]=a["class"],f=g[o].length>0?g[o][g[o].length-1]:null,0==o?(p=-1,d=null):(d=g[o-1][g[o-1].length-1],p=d.col),f&&f.title==b.title&&f.level==b.level&&p<l?(f.colspan++,f.width+=b.width):(g[o].push(b),b.parent_col=d,0==l?b.left=0:f?b.left=f.left+f.width:d?b.left=d.left:b.left=0),a.left=b.left;var u=[];for(l=0;l<e;l++)u=u.concat(g[l]);return u}function o(t){return function(){return s[t].apply(s,arguments)}}function a(t){return function(){return s._data[t].apply(s._data,arguments)}}var s=this;if(this.root.instance=this,t.options)for(var c in t.options)t[c]=t.options[c];this.nameField=t.nameField||"name",this.titleField=t.titleField||"title",this.onUpdate=t.onUpdate||function(){},this.onSort=t.onSort||function(){},this.onRowClass=t.onRowClass||function(){},this.cols=t.cols.slice(),this.rowHeight=t.rowHeight||34,this.indexColWidth=t.indexColWidth||40,this.multiSelect=t.multiSelect||!1,this.visCells=[],this.selected_rows=[],this.sort_cols=[],this.clickSelect=t.clickSelect||"row",this.noData=t.noData||"No Data",this.container=t.container||$(this.root).parent(),t.data?Array.isArray(t.data)?(this._data=new DataSet,this._data.add(t.data)):this._data=t.data:this._data=new DataSet,this.bind=function(){s._data.on("*",function(t,e){if(s.onUpdate(s._data,t,e),"remove"==t)for(var i,l=e.items,r=0,o=l.length;r<o;r++)i=s.selected_rows.indexOf(l[r].id),i!==-1&&s.selected_rows.splice(i,1);s.ready_data(),s.calData(),s.update()})},this.ready_data=function(){var e=[];if(!t.remoteSort&&this.sort_cols.length){for(i=0,len=this.sort_cols.length;i<len;i++)col=this.sort_cols[i],"desc"==col.direction?e.push("-"+col.name):"asc"==col.direction&&e.push(col.name);this.rows=this._data.get({order:e})}else this.rows=this._data.get()},this.on("mount",function(){this.content=this.root.querySelectorAll(".rtable-body.rtable-main")[0],this.header=this.root.querySelectorAll(".rtable-header.rtable-main")[0],this.content_fixed=this.root.querySelectorAll(".rtable-body.rtable-fixed")[0],this.browser=e(),this._updated=!1,window.addEventListener("resize",function(){"auto"!=t.width&&t.width&&t.height||s.resize()}),this.content.addEventListener("mousewheel",function(t){s.mousewheel(t)}),this.ready_data(),this.calSize(),this.calHeader(),this.calData(),this.calScrollbar(),this.bind(),this.update()}),this.on("updated",function(){this._updated||(this._updated=!0,this.resize())}),this.click_handler=function(t){t.preventDefault(),"row"===s.clickSelect?s.toggle_select(t.item.col.row):"column"===s.clickSelect},this.sort_handler=function(t){var e,i,l;t.preventDefault(),e=t.item.name,0==s.sort_cols.length?i="asc":(l=s.sort_cols[0],i="desc"!=l.direction&&("asc"==l.direction?"desc":"asc")),i?s.sort_cols=[{name:e,direction:i}]:s.sort_cols=[],s.remoteSort?s._data.load(s.onSort.call(s,s.sort_cols)):(s.ready_data(),s.calData())},this.get_sort_top=function(t){var e;return e="asc"==t?(s.rowHeight-16)/2+4:"desc"==t?(s.rowHeight-16)/2+2:(s.rowHeight-16)/2+4},this.colresize=function(t){var e,i=t.clientX,l=$(this.header),r=$(document),o=t.item,a=o.width;document.selection&&document.selection.empty&&(document.selection.empty(),1)||window.getSelection&&window.getSelection().removeAllRanges(),document.body.onselectstart=function(){return!1},l.css("-moz-user-select","none"),r.on("mousemove",function(t){e=Math.max(a+t.clientX-i,5),o.real_col.width=e,s.resize()}).on("mouseup",function(t){document.body.onselectstart=function(){return!0},l.css("-moz-user-select","text"),r.off("mousemove").off("mouseup")})},this.on("update",function(){this.start=t.start||0,this.content&&this.calVis()}),this.calHeader=function(){var e,i,l,o,a,c,h,n,d,b=[],p=[],f=[],g=0;c=0;for(var u=0,w=s.cols.length;u<w&&("__index_col__"==s.cols[u][s.nameField]?n=!0:"__check_col__"==s.cols[u][s.nameField]&&(d=!0),!n||!d);u++);for(t.indexCol&&!n&&(a={render:function(t,e,i){return e.index+1},width:s.indexColWidth,frozen:!0,align:"center"},a[this.nameField]="__index_col__",a[this.titleField]="#",this.cols.unshift(a)),l=0,o=s.cols.length;l<o;l++)if(this.cols[l].frozen){h=!0;break}for(t.checkCol&&!d&&(a={type:"check",width:30,align:"center",frozen:h},a[this.nameField]="__check_col__",a[this.titleField]="_check",t.indexCol?this.cols.splice(1,0,a):this.cols.unshift(a)),l=0,o=this.cols.length;l<o;l++)a=this.cols[l],a.hidden||(a.frozen?b.push(a):p.push(a),a.name=a[this.nameField],a.title=a[this.titleField]||a.name,a.subs=a.title.split("/"),c=Math.max(c,a.subs.length),a.width?g+=a.width:f.push(a));if(f.length>0)for(var _=Math.floor((this.width-g)/f.length),l=0,o=f.length;l<o;l++)f[l].width=_,l==f.length-1&&(f[l].width=this.width-g-(f.length-1)*_);e=r(p,c,!1),i=r(b,c,!0),this.fix_cols=b,this.main_cols=p,this.fix_columns=i,this.main_columns=e,this.max_level=c;for(var a,x=0,m=0,l=0,o=this.cols.length;l<o;l++)a=this.cols[l],a.hidden||(a.frozen?x+=a.width:m+=a.width);this.header_height=this.max_level*this.rowHeight,this.fix_width=x,this.main_width=m},this.calSize=function(){"auto"!==t.width&&t.width?this.width=t.width:this.width=$(this.container).width(),t.height?"auto"==t.height||(this.height=t.height):this.height=$(this.container).height()},this.calScrollbar=function(){this.scrollbar_width=l(),this.has_yscroll=this.content.scrollHeight>this.content.clientHeight||this.rows.length*this.rowHeight>this.height-this.header_height,this.has_xscroll=this.content.scrollWidth>this.content.clientWidth||this.main_width>this.width-this.fix_width,this.xscroll_width=this.has_xscroll?this.scrollbar_width:0,this.yscroll_width=this.has_yscroll?this.scrollbar_width:0,this.xscroll_fix=this.browser.ie&&this.has_xscroll?this.xscroll_width:0,this.yscroll_fix=this.browser.ie&&this.has_yscroll?this.yscroll_width:0},this.calData=function(){"auto"==t.height&&(this.height=Math.max(1,this.rows.length)*this.rowHeight+this.header_height,t.maxHeight&&(this.height=Math.min(t.maxHeight,this.height)),0==this.rows.length&&t.minHeight&&(this.height=Math.max(t.minHeight,this.height)))},this.calVis=function(){var t,e,i,l,r,o,a,s,c,h,n,d,b,p,f,g,u;b={},b.top=this.content.scrollTop,b.left=this.content.scrollLeft,b.bottom=b.top+this.height-this.header_height-this.scrollbar_width,b.right=b.left+this.main_width-this.fix_width-this.scrollbar_width,first=Math.max(Math.floor(this.content.scrollTop/this.rowHeight),0),i=Math.ceil((this.content.scrollTop+this.height-this.header_height)/this.rowHeight);(new Date).getTime();for(h=this.rows.slice(first,i),p=[],f=[],d=this.rowHeight,o=this.fix_columns.concat(this.main_columns),t=0,l=h.length;t<l;t++)for(a=h[t],g={row:a,cols:[],line:first+t},u={row:a,cols:[],line:first+t},p.push(g),f.push(u),n=d*(first+t),e=0,r=o.length;e<r;e++)s=o[e],c={top:n,width:s.width,height:d,left:s.left,row:a,style:s.style,type:s.type,selected:this.is_selected(a),render:s.render,buttons:s.buttons,index:first+t,sor:s.sort,align:s.align,"class":s["class"]},c.value=this.get_col_data(c,a[s.name]),s.frozen?u.cols.push(c):c.left>b.right||c.right<b.left||g.cols.push(c);this.visCells={fixed:f,main:p}},this.get_sorted=function(t){for(var e,i=0,l=this.sort_cols.length;i<l;i++)if(e=this.sort_cols[i],e.name==t&&e.direction)return e.direction},this.scrolling=function(t){return t.preventUpdate=!0,this.header.scrollLeft=this.content.scrollLeft,this.content_fixed.scrollTop=this.content.scrollTop,this.update()};var h=function(t){var e=10,i=40,l=800,r=0,o=0,a=0,s=0;return"detail"in t&&(o=t.detail),"wheelDelta"in t&&(o=-t.wheelDelta/120),"wheelDeltaY"in t&&(o=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(r=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(r=o,o=0),a=r*e,s=o*e,"deltaY"in t&&(s=t.deltaY),"deltaX"in t&&(a=t.deltaX),(a||s)&&t.deltaMode&&(1==t.deltaMode?(a*=i,s*=i):(a*=l,s*=l)),a&&!r&&(r=a<1?-1:1),s&&!o&&(o=s<1?-1:1),{spinX:r,spinY:o,pixelX:a,pixelY:s}};this.mousewheel=function(t){t.preventDefault();var e=h(event);return Math.abs(e.pixelX)>Math.abs(e.pixelY)?(this.header.scrollLeft=this.header.scrollLeft+e.pixelX,this.content.scrollLeft=this.content.scrollLeft+e.pixelX):(this.header.scrollTop=this.header.scrollTop+e.pixelY,this.content.scrollTop=this.content.scrollTop+e.pixelY),!1},this.checkall=function(t){t.target.checked?s.selected_rows=s._data.getIds():s.selected_rows=[]},this.checkcol=function(t){t.target.checked?s.select(t.item.col.row):s.deselect(t.item.col.row)},this.toggle_select=function(t){this.is_selected(t)?s.deselect(t):s.select(t)},this.select=function(e){var i,l;t.multiSelect||(s.selected_rows=[]),e||(e=this._data.get()),Array.isArray(e)||(e=[e]);for(var r=0,o=e.length;r<o;r++)i=e[r],l=i instanceof Object?i.id:i,this.selected_rows.indexOf(l)==-1&&this.selected_rows.push(l)},this.deselect=function(t){var e,i,l,r=this.selected_rows,o=[];if(t){Array.isArray(t)||(t=[t]);for(var a=0,s=t.length;a<s;a++)l=t[a]instanceof Object?t[a].id:t[a],o.push(l);for(var a=r.length-1;a>-1&&(e=r[a],i=o.indexOf(e),i!=-1&&(r.splice(a,1),o.splice(i,1)),0!=t.length);a--);}else this.selected_rows=[]},this.is_selected=function(t){var e;if(t)return e=t instanceof Object?t.id:t,s.selected_rows.indexOf(e)!==-1},this.root.is_selected=o("is_selected"),this.get_selected=function(){return this._data.get({filter:function(t){return s.selected_rows.indexOf(t.id)!==-1}})},this.root.get_selected=o("get_selected"),this.resize=function(){s.calSize(),s.calHeader(),s.calData(),s.calScrollbar(),s.header.scrollLeft=s.content.scrollLeft,s.content_fixed.scrollTop=s.content.scrollTop,s.update()},this.root.add=a("add"),this.root.update=a("update"),this.root.remove=a("remove"),this.root.get=a("get"),this.root.load=a("load"),this.root.setData=function(t){s._data=t,s.bind()}.bind(this),this.get_col_data=function(t,e){return t.render&&"function"==typeof t.render?t.render(t.row,t,e):e},this.action_click=function(t,e){return function(i){e.onclick&&"function"==typeof e.onclick&&e.onclick.call(i.target,t.row,s)}},this.get_cell_class=function(t){var e=[];return e.push("rtable-cell"),t.selected&&e.push("selected"),t["class"]&&e.push(t["class"]),e.join(" ")},this.get_row_class=function(t,e){var i,l=[];return l.push("rtable-row"),e%2==1?l.push("odd"):l.push("even"),i=this.onRowClass(t,e),i&&l.push(i),l.join(" ")},this.addClass=function(t,e){var i=this[t].split(/\s+/);i.indexOf(e)<0&&i.push(e),this[t]=i.join(" ")},this.removeClass=function(t,e){if(this.hasClass(t,e)){var i=this[t].split(/\s+/);i.splice(i.indexOf(e),1),this[t]=i.join(" ")}},this.hasClass=function(t,e){return this[t].split(/\s+/).indexOf(e)>-1}}),riot.tag2("raw","<span></span>","","",function(t){this.on("mount",function(){this.root.innerHTML=t.content}),this.on("update",function(){this.root.innerHTML=t.content})});