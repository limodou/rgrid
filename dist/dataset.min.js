function DataSet(t,e){if(t&&!Array.isArray(t)&&(e=t,t=null),this._options=e||{},this._data=[],this._ids={},this.length=0,this._fieldId=this._options.fieldId||"id",this._parentFieldId=this._options.parentFieldId||"_parent",this._childFieldId=this._options.childFieldId||"nodes",this._orderFieldId=this._options.orderFieldId||"order",this._type={},this._options.type)for(var r in this._options.type)if(this._options.type.hasOwnProperty(r)){var i=this._options.type[r];"Date"==i||"ISODate"==i||"ASPDate"==i?this._type[r]="Date":this._type[r]=i}this._subscribers={},this.remove=this.async_call(remove),t&&this.add(t)}function Util(){function t(t,e,r){var i=e&&r||0,n=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[i+n++]=f[t])});n<16;)e[i+n++]=0;return e}function e(t,e){var r=e||0,i=u;return i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]}function r(t,r,i){var n=r&&i||0,o=r||[];t=t||{};var a=void 0!==t.clockseq?t.clockseq:c,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),u=void 0!==t.nsecs?t.nsecs:y+1,f=s-p+(u-y)/1e4;if(f<0&&void 0===t.clockseq&&(a=a+1&16383),(f<0||s>p)&&void 0===t.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=s,y=u,c=a,s+=122192928e5;var d=(1e4*(268435455&s)+u)%4294967296;o[n++]=d>>>24&255,o[n++]=d>>>16&255,o[n++]=d>>>8&255,o[n++]=255&d;var h=s/4294967296*1e4&268435455;o[n++]=h>>>8&255,o[n++]=255&h,o[n++]=h>>>24&15|16,o[n++]=h>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(var _=t.node||l,v=0;v<6;v++)o[n+v]=_[v];return r?r:e(o)}function i(t,r,i){var o=r&&i||0;"string"==typeof t&&(r="binary"==t?new Array(16):null,t=null),t=t||{};var a=t.random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,r)for(var s=0;s<16;s++)r[o+s]=a[s];return r||e(a)}var n,o="undefined"!=typeof window?window:"undefined"!=typeof global?global:null;if(o&&o.crypto&&crypto.getRandomValues){var a=new Uint8Array(16);n=function(){return crypto.getRandomValues(a),a}}if(!n){var s=new Array(16);n=function(){for(var t,e=0;e<16;e++)0===(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s}}for(var u=[],f={},d=0;d<256;d++)u[d]=(d+256).toString(16).substr(1),f[u[d]]=d;var h=n(),l=[1|h[0],h[1],h[2],h[3],h[4],h[5]],c=16383&(h[6]<<8|h[7]),p=0,y=0,_=i;_.v1=r,_.v4=i,_.parse=t,_.unparse=e,isNumber=function(t){return t instanceof Number||"number"==typeof t},isString=function(t){return t instanceof String||"string"==typeof t},isDate=function(t){if(t instanceof Date)return!0;if(isString(t)){var e=v.exec(t);if(e)return!0;if(!isNaN(Date.parse(t)))return!0}return!1},convert=function(t,e){var r;if(void 0!==t){if(null===t)return null;if(!e)return t;if("string"!=typeof e&&!(e instanceof String))throw new Error("Type must be a string");switch(e){case"boolean":case"Boolean":return Boolean(t);case"number":case"Number":return Number(t.valueOf());case"string":case"String":return String(t);case"Date":if(isNumber(t))return new Date(t);if(t instanceof Date)return new Date(t.valueOf());if(moment.isMoment(t))return new Date(t.valueOf());if(isString(t))return r=v.exec(t),r?new Date(Number(r[1])):moment(t).toDate();throw new Error("Cannot convert object of type "+getType(t)+" to type Date");case"Moment":if(isNumber(t))return moment(t);if(t instanceof Date)return moment(t.valueOf());if(moment.isMoment(t))return moment(t);if(isString(t))return r=v.exec(t),r?moment(Number(r[1])):moment(t);throw new Error("Cannot convert object of type "+getType(t)+" to type Date");case"ISODate":if(isNumber(t))return new Date(t);if(t instanceof Date)return t.toISOString();if(moment.isMoment(t))return t.toDate().toISOString();if(isString(t))return r=v.exec(t),r?new Date(Number(r[1])).toISOString():new Date(t).toISOString();throw new Error("Cannot convert object of type "+getType(t)+" to type ISODate");case"ASPDate":if(isNumber(t))return"/Date("+t+")/";if(t instanceof Date)return"/Date("+t.valueOf()+")/";if(isString(t)){r=v.exec(t);var i;return i=r?new Date(Number(r[1])).valueOf():new Date(t).valueOf(),"/Date("+i+")/"}throw new Error("Cannot convert object of type "+getType(t)+" to type ASPDate");default:throw new Error('Unknown type "'+e+'"')}}};var v=/^\/?Date\((\-?\d+)/i;getType=function(t){var e=typeof t;return"object"==e?null===t?"null":t instanceof Boolean?"Boolean":t instanceof Number?"Number":t instanceof String?"String":Array.isArray(t)?"Array":t instanceof Date?"Date":"Object":"number"==e?"Number":"boolean"==e?"Boolean":"string"==e?"String":void 0===e?"undefined":e},this.getType=getType,this.convert=convert,this.uuid=_,this.isNumber=isNumber,this.isString=isString}DataSet.prototype.on=function(t,e){var r=this._subscribers[t];r||(r=[],this._subscribers[t]=r),r.push({callback:e})},DataSet.prototype.off=function(t,e){var r=this._subscribers[t];r&&(this._subscribers[t]=r.filter(function(t){return t.callback!=e}))},DataSet.prototype._trigger=function(t,e,r){if("*"==t)throw new Error("Cannot trigger event *");var i=[];t in this._subscribers&&(i=i.concat(this._subscribers[t])),"*"in this._subscribers&&(i=i.concat(this._subscribers["*"]));for(var n=0;n<i.length;n++){var o=i[n];o.callback&&o.callback(t,e,r||null)}},DataSet.prototype.async_call=function(t){var e=this,r=function(r,i){var n;if(i){if("string"==typeof i)n=function(){return $.post(i)};else{if("function"!=typeof i)throw new Error("url should be string or function type");n=i}return $.when(n()).done(function(r){return ret=t.call(e,r.data),ret})}return t.call(e,r)};return r},DataSet.prototype.add=function(t,e){var r,i=[],n=this;if(Array.isArray(t))for(var o=0,a=t.length;o<a;o++)r=n._addItem(t[o],e),i.push(r),t[o][n._childFieldId]&&t[o][n._childFieldId].length>0&&i.concat(n.add(t[o][n._childFieldId],t[o][n._fieldId]));else{if(!(t instanceof Object))throw new Error("Unknown dataType");r=n._addItem(t,e),i.push(r),t[n._childFieldId]&&t[n._childFieldId].length>0&&i.concat(n.add(t[n._childFieldId],t[n._fieldId]))}return i.length&&this._trigger("add",{items:i}),i},DataSet.prototype.load=function(t,e){var r=this;return this._data=[],this._ids={},this.length=0,"string"==typeof t?$.getJSON(t||this._options.url).done(function(t){e?r.add(e(t)):r.add(t)}):void(e?r.add(e(t)):r.add(t))},DataSet.prototype.update=function(t,e){var r=[],i=[],n=[],o=this,a=o._fieldId,s=function(t){var e=t[a];o._ids.hasOwnProperty(e)?(e=o._updateItem(t),i.push(e),n.push(t)):(e=o._addItem(t),r.push(e))};if(Array.isArray(t))for(var u=0,f=t.length;u<f;u++)s(t[u]);else{if(!(t instanceof Object))throw new Error("Unknown dataType");s(t)}return r.length&&this._trigger("add",{items:r},e),i.length&&this._trigger("update",{items:i,data:n},e),r.concat(i)},DataSet.prototype.get=function(t){var e,r,i,n=this,o=util.getType(arguments[0]);"String"==o||"Number"==o?(e=arguments[0],i=arguments[1]):"Array"==o?(r=arguments[0],i=arguments[1]):i=arguments[0];var a;if(i&&i.returnType){var s=["Array","Object"];a=s.indexOf(i.returnType)==-1?"Array":i.returnType}else a="Array";var u,f,d,h,l=i&&i.type||this._options.type,c=i&&i.filter,p=[];if(void 0!=e)u=n._getItem(e,l),c&&!c(u)&&(u=null);else if(void 0!=r)for(d=0,h=r.length;d<h;d++)u=n._getItem(r[d],l),c&&!c(u)||p.push(u);else if(c)for(f in this._ids)u=n._getItem(f,l),c&&!c(u)||p.push(u);else p=this._data.slice();if(i&&i.order&&void 0==e&&this._sort(p,i.order),i&&i.fields){var y=i.fields;if(void 0!=e)u=this._filterFields(u,y);else for(d=0,h=p.length;d<h;d++)p[d]=this._filterFields(p[d],y)}if("Object"==a){var _={};for(d=0;d<p.length;d++)_[p[d].id]=p[d];return _}return void 0!=e?u:p},DataSet.prototype.tree=function(t){for(var e,r,i,n,o,a=this,s={},u=[],f=this.get({order:[a._parentFieldId,a._orderFieldId]}),d=0,h=f.length;d<h;d++){r={},i=f[d];for(k in i)r[k]=i[k];e=r[a._fieldId],n=r[a._parentFieldId]||0,n?(o=s[n],o.hasOwnProperty(a._childFieldId)?o[a._childFieldId].push(r):o[a._childFieldId]=[r]):u.push(r),s[e]=r}return u},DataSet.prototype.getIds=function(t){var e,r,i,n,o,a=this._data,s=t&&t.filter,u=t&&t.order,f=t&&t.type||this._options.type,d=[];if(s)if(u){o=[];for(i in a)a.hasOwnProperty(i)&&(n=this._getItem(i,f),s(n)&&o.push(n));for(this._sort(o,u),e=0,r=o.length;e<r;e++)d[e]=o[e][this._fieldId]}else for(i in a)a.hasOwnProperty(i)&&(n=this._getItem(i,f),s(n)&&d.push(n[this._fieldId]));else if(u){o=[];for(i in a)a.hasOwnProperty(i)&&o.push(a[i]);for(this._sort(o,u),e=0,r=o.length;e<r;e++)d[e]=o[e][this._fieldId]}else for(i in a)a.hasOwnProperty(i)&&(n=a[i],d.push(n[this._fieldId]));return d},DataSet.prototype.getDataSet=function(){return this},DataSet.prototype.forEach=function(t,e){var r,i=e&&e.filter,n=(e&&e.type||this._options.type,this._data);this._ids;if(e&&e.order)for(var o=this.get(e),a=0,s=o.length;a<s;a++)r=o[a],t(r,a);else for(var a=0,s=n.length;a<s;a++)r=n[a],i&&!i(r)||t(r,a)},DataSet.prototype.map=function(t,e){for(var r,i,n=e&&e.filter,o=(e&&e.type||this._options.type,[]),a=this._data,s=a.length;i<s;i++)r=a[i],n&&!n(r)||o.push(t(r,id));return e&&e.order&&this._sort(o,e.order),o},DataSet.prototype._filterFields=function(t,e){if(!t)return t;var r={};if(Array.isArray(e))for(var i in t)t.hasOwnProperty(i)&&e.indexOf(i)!=-1&&(r[i]=t[i]);else for(var i in t)t.hasOwnProperty(i)&&e.hasOwnProperty(i)&&(r[e[i]]=t[i]);return r},DataSet.prototype._by=function(t,e,r){return e=e||!1,function(i,n){var o,a;if("object"==typeof i&&"object"==typeof n&&i&&n)return o=i[t],a=n[t],o===a?"function"==typeof r?r(i,n):0:typeof o==typeof a?e?o<a?1:-1:o<a?-1:1:0;throw"error"}},DataSet.prototype._sort=function(t,e){if(util.isString(e)||Array.isArray(e)){var r,i,n,o,a=null,s=this;r=util.isString(e)?[e]:e;for(var u=r.length-1;u>-1;u--)i=r[u],i&&"-"===i.charAt(0)?(o=!0,i=i.substr(1)):o=!1,n=a?s._by(i,o,a):s._by(i,o),a=n;return t.sort(n)}if("function"==typeof e)return t.sort(e);throw new TypeError("Order must be a function or a string")},remove=function(t){var e,r,i,n=[];if(Array.isArray(t))for(e=0,r=t.length;e<r;e++)i=this._remove(t[e]),null!=i&&n.push(i);else i=this._remove(t),null!=i&&n.push(i);return n.length&&this._trigger("remove",{items:n}),n},DataSet.prototype._remove=function(t){var e,r;if(util.isNumber(t)||util.isString(t)?r=t:t instanceof Object&&(r=t[this._fieldId]),r&&(e=this._ids[r],e!==-1)){this._data.splice(e,1),this.length--,this._ids={};for(var i=0,n=this.length;i<n;i++)this._ids[this._data[i][this._fieldId]]=i;return t}return null},DataSet.prototype.clear=function(t){var e=Object.keys(this._ids);return this._data=[],this._ids={},this.length=0,this._trigger("remove",{items:e},t),e},DataSet.prototype._addItem=function(t,e){var r=t[this._fieldId];if(void 0!=r){if(this._ids.hasOwnProperty(r))throw new Error("Cannot add item: item with id "+r+" already exists")}else r=util.uuid.v4(),t[this._fieldId]=r;var i={};for(var n in t)if(t.hasOwnProperty(n)){var o=this._type[n];i[n]=util.convert(t[n],o)}return e&&(i[this._parentFieldId]=e),this._data.push(i),this.length++,this._ids[r]=this.length-1,r},DataSet.prototype.index=function(t){var e;return util.isNumber(t)||util.isString(t)?e=t:t instanceof Object&&(e=t[this._fieldId]),this._ids[e]},DataSet.prototype._getItem=function(t,e){var r,i,n=this._ids[t],o=this._data[n];if(!o)return null;var a={};if(e)for(r in o)o.hasOwnProperty(r)&&(i=o[r],a[r]=util.convert(i,e[r]));else for(r in o)o.hasOwnProperty(r)&&(i=o[r],a[r]=i);return a},DataSet.prototype._updateItem=function(t){var e=t[this._fieldId];if(void 0==e)throw new Error("Cannot update item: item has no id (item: "+JSON.stringify(t)+")");var r=this._ids[e],i=this._data[r];if(!i)throw new Error("Cannot update item: no item with id "+e+" found");for(var n in t){var o=this._type[n];i[n]=util.convert(t[n],o)}return e};var util=new Util;