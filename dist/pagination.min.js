riot.tag2("pagination",'<ul class="pagination"> <li if="{totalMessage}" class="disabled total"><a>{totalMessage}</a></li> <li if="{has_first}" class="first"><a href="#" onclick="{go(1)}"><raw content="{first}"></raw></a></li> <li if="{has_prev}" class="prev"><a href="#" onclick="{go(page-1)}"><raw content="{prev}"></raw></a></li> <li class="{page:true, active:p==page}" each="{p in pages}"><a href="#" onclick="{go(p)}">{p}</a></li> <li if="{has_next}" class="next"><a href="#" onclick="{go(page+1)}"><raw content="{next}"></raw></a></li> <li if="{has_last}" class="last"><a href="#" onclick="{go(totalPages)}"><raw content="{last}"></raw></a></li> <li if="{refresh}" class="refresh"><a href="#" onclick="{go(page)}"><raw content="{refresh}"></raw></a></li> </ul>',"","",function(t){var a=this;this.total=t.total,this.page=t.page||1,this.limit=t.limit||10,this.url=t.url,this.data=t.data,this.limits=t.limits||[10,20,30,40,50],this.size=t.size||10,this.pages=[],this.onpage=t.onpage||function(){return a.data.load(a.get_url(),function(t){return a.total=t.total,t.rows})},this.onpagechanged=t.onpagechanged,this._totalMessage=t.totalMessage||"共 $pages 页 / $records 条记录",this.prev=t.prev||"上一页",this.has_prev=!1,this.next=t.next||"下一页",this.has_next=!1,this.first=t.first||"首页",this.has_first=!1,this.last=t.last||"尾页",this.has_last=!1,this.refresh=t.refresh||"刷新",this.on("update",function(){this.total=t.total,a.show()}),this.get_url=function(t){return get_url(a.url,{page:t||a.page,limit:a.limit})},this.go=function(t){return f=function(s){a.page=t,a.onpage&&"function"==typeof a.onpage?$.when(a.onpage.call(a,t)).done(function(s){a.show(t),a.onpagechanged&&a.onpagechanged(t)}):a.show()},f},this.show=function(s){a.total=t.total||a.total,a.page=s||a.page,a.totalPages=parseInt(a.total/a.limit),a.total%a.limit>0&&a.totalPages++,a._totalMessage&&(a.totalMessage=a._totalMessage.replace("$pages",a.totalPages),a.totalMessage=a.totalMessage.replace("$records",a.total));var s=a.page,e=a.size/2;a.size%2>0&&(e=(a.size+1)/2);var i=1;s>=1&&s<=a.totalPages&&s>=e&&(i=a.totalPages-s>=e?s-(e-1):Math.max(a.totalPages-a.size+1,1)),a.pages=[];for(var l=i,o=Math.min(i+a.size-1,a.totalPages);l<=o;l++)a.pages.push(l);a.size>1?(a.has_prev=a.prev&&s>1,a.has_next=a.next&&s<a.totalPages,a.has_first=1!==i,a.has_last=a.pages[a.pages.length-1]<a.totalPages):(a.has_prev=!1,a.has_next=!1,a.has_last=!1,a.has_first=!1),a.update()}}),riot.tag2("raw","<span></span>","","",function(t){this.on("update",function(){this.root.innerHTML=t.content})});